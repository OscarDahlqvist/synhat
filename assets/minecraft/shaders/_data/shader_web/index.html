<head>
  <title>Look at this  graph</title>
  <style>
    :root {
      --face-select-scale: 4px
    }
    html, body {
      margin: 0;
      height: 100%;
      font-family:Arial, Helvetica, sans-serif;
    }
    canvas {
      image-rendering: pixelated;
    }
    textarea {
      height: 200px;
      width: 100%;
    }
    #camera {
      width: 100%;
      height: 100%;
      min-width: none;
    }
    #setting {
      width: 100%;
      height: 100%;
    }
    .PixelSettingsItem {
      margin: 4px;
      background-color:lightgreen;
      padding: 5px;
    }
    .debug {
      background-color:lightcoral;
    }
    #winEditorGrid {
      display: grid;
      width: 100%;
      height: 100%;

      grid-template-columns: 260px auto 50%;
      grid-template-rows: 32px 260px auto;
      grid-template-areas:
        "header header header"
        "faceselect globaltransform transform"
        "camera camera json"
      ;
    }
    #winHeader {
      grid-area: header;
      min-width: 0;
      background-color:lightgreen;
      padding: 5px;
    }
    #winGlobal {
      grid-area: globaltransform;
      min-width: 0;
      padding: 5px;
    }
    #winFaceSelect {
      background-color:#666666;
      grid-area: faceselect;
      min-width: 0;
    }
    #winFaceSelectFixedResolution {
      position: relative;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      height: calc(64 * var(--face-select-scale));
      width: calc(64 * var(--face-select-scale));
      background-size: var(--face-select-scale) var(--face-select-scale);
      background-color: #ffffff;
      background-image:
        linear-gradient(to right, #aaaaaa 1px, transparent 1px),
        linear-gradient(to bottom, #aaaaaa 1px, transparent 1px);
    }
    #winFaceTransformSettings {
      grid-area: transform;
      min-width: 0;
    }
    #winCamera {
      grid-area: camera;
      min-width: 0;
    }

  </style>
</head>
<body>
  <div x-data='{
    CONST:{
      displacement_slider_max:63,
      displacement_slider_min:-63,
      uv_offset_slider_max:63,
      uv_offset_slider_min:0,
      uv_crop_slider_max:63,
      uv_crop_slider_min:0,
    }
  }'>
    <div id="winEditorGrid">
      <div id="winGlobal">
        <input type="file" id="uploadInputImage" name="uploadInputImage" accept="image/*"
          x-on:change='MAIN.changedUploadImage'
          x-init='MAIN.resetSelectedSkin'>
        </input>
        <br><button type="button" x-on:click='alert("TODO")'>Download Skin</button>
        <br>
        <br><button type="button" x-on:click='alert("TODO")'>Upload Model Json</button>
        <br><button type="button" x-on:click='alert("TODO")'>Download Model Json</button>
        <br>
        <br><button type="button" x-on:click='MAIN.resetSelectedSkin'>Reset</button>
      </div>

      <div id="winHeader">
        Header
      </div>

      <div id="winCamera">
        <canvas id="camera"></canvas>
      </div>

      <div id="winFaceSelect">
        <div id="winFaceSelectFixedResolution">
          <canvas id="canvasSkinPreview" width="64" height="64" style="
            height: 100%;
            position: absolute;
            left: 0; top: 0;
            z-index: 0;
          ">
          </canvas>
        </div>
      </div>

      <div id="winFaceTransformSettings">
        <div id="setting" class="PixelSettings" x-data='{content:[]}'>
          <!--Add New Transform DOM-->
          <div class="PixelSettingsItem">
            <div>Face Transforms</div>
            <button type="button" x-on:click='
              ids = content.map((x) => x.id);
              max = Math.max(0, ...ids);
              content.push({
                id: (max+1),
                type: MAIN.enums.transform_type.displacement,
                data: JSON.parse(JSON.stringify(
                  MAIN.default_transform[MAIN.enums.transform_type.displacement]
                ))
              })
            '>Add</button>
            <button type="button" x-on:click='alert("copy all")'>Copy All</button>
            <button type="button" x-on:click='alert("paste all")'>Paste All</button>
            <button type="button" x-on:click='content=[]'>Delete All</button>
            <button type="button" x-on:click='MAIN.debugAllTransforms(content)'>Debug</button>
          </div>

          <template x-for="(item, index) in content" :key="item.id">
            <div class="PixelSettingsItem">
              <!-- Universal Transform Header (Type / Delete)-->
              <div>
                <select x-model.number="item.type" x-on:change='
                  item.data = JSON.parse(JSON.stringify(MAIN.default_transform[item.type]));
                '>
                  <template x-for="[k, v] in Object.entries(MAIN.enums.transform_type)">
                    <option x-html="k" x-bind:value="v"></option>
                  </template>
                </select>
                <button type="button" x-on:click="alert('copy')">Copy</button>
                <button type="button" x-on:click="alert('paste')">Paste</button>
                <button type="button" x-on:click='content.splice(index, 1)'>Delete</button>
              </div>

              <br>
              <textarea class="debug" x-html='JSON.stringify(item, null, 2)'></textarea>
              <br><br>

              <!--Displacement DOM-->
              <template x-if='item.type == MAIN.enums.transform_type.displacement'>
                <div>
                  <label>Snap to opposing layer</label>
                  <input type="checkbox" x-model.number="item.data.snap"><br><br>

                  <label>Displacement in half pixels (between 0 and 63):</label>
                  <div class="xslider" x-data='{_asSigned: null}' x-init='
                    eval(MAIN.MakeExprToCreateSignedTwoWayBinding(
                      "_asSigned", "item.data.global_displacement", "item.data.sign"
                    ))
                  '>
                    <input type="reset" x-on:click="_asSigned = 0">
                    <input type="number" x-model.number="_asSigned" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                    <input type="range" x-model.number="_asSigned" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                  </div><br>

                  <label>Assymetric Direction:</label>
                  <select x-model.number="item.data.asym_edge">
                    <template x-for="[k, v] in Object.entries(MAIN.enums.asym_edge)">
                      <option x-html="k" x-bind:value="v"></option>
                    </template>
                  </select><br><br>

                  <label>Use Special Assymetric Displacement Transform </label>
                  <input type="checkbox" x-model.number="item.data.asym_spec"><br><br>

                  <div x-show='!item.data.asym_spec'>
                    <label>Assymetric Displacement in half pixels (between -63 and 63):</label>

                    <div class="xslider" x-data='{_asSigned: null}' x-init='
                      eval(MAIN.MakeExprToCreateSignedTwoWayBinding(
                        "_asSigned", "item.data.asym_displacement", "item.data.asym_sign"
                      ))
                    '>
                      <input type="reset" x-on:click="_asSigned=0">
                      <input type="number" x-model.number="_asSigned" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                      <input type="range" x-model.number="_asSigned" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                    </div>
                  </div>

                  <div x-show='!!item.data.asym_spec'>
                    <label>Assymetric Special Mode</label>
                    <select x-model="item.data.asym_displacement">
                      <template x-for="[k, v] in Object.entries(MAIN.enums.asym_special_mode)">
                        <option x-html="k" x-bind:value="v"></option>
                      </template>
                    </select>
                  </div>
                </div>
              </template>

              <!--Special DOM-->
              <template x-if='item.type == MAIN.enums.transform_type.special'>
                <div>
                  <label>UV Scale Fix</label><br>
                  <label>Top</label>
                  <input type="checkbox" x-model="item.data.top_snap_clip_uv"><br>
                  <label>Bottom</label>
                  <input type="checkbox" x-model="item.data.bot_snap_clip_uv"><br>
                  <label>Left</label>
                  <input type="checkbox" x-model="item.data.left_snap_clip_uv"><br>
                  <label>Right</label>
                  <input type="checkbox" x-model="item.data.right_snap_clip_uv"><br>
                </div>
              </template>

              <!--UV Offset DOM-->
              <template x-if='item.type == MAIN.enums.transform_type.uv_offset'>
                <div>
                  <label>UV Crop</label><br>
                  <div class="xslider">
                    <label>X min</label>
                    <input type="reset" x-on:click="item.data.x_min=0">
                    <input type="number" x-model.number="item.data.x_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                    <input type="range" x-model.number="item.data.x_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                  </div>
                  <div class="xslider">
                    <label>X max</label>
                    <input type="reset" x-on:click="item.data.x_max=0">
                    <input type="number" x-model.number="item.data.x_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                    <input type="range" x-model.number="item.data.x_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                  </div>
                  <div class="xslider">
                    <label>Y min</label>
                    <input type="reset" x-on:click="item.data.y_min=0">
                    <input type="number" x-model.number="item.data.y_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                    <input type="range" x-model.number="item.data.y_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                  </div>
                  <div class="xslider">
                    <label>Y max</label>
                    <input type="reset" x-on:click="item.data.y_max=0">
                    <input type="number" x-model.number="item.data.y_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                    <input type="range" x-model.number="item.data.y_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                  </div>
                </div>
              </template>

              <!--UV Crop DOM-->
              <template x-if='item.type == MAIN.enums.transform_type.uv_crop'>
                <div>
                  <label>UV Offset</label><br>
                  <div class="xslider">
                    <label>Top</label>
                    <input type="reset" x-on:click="item.data.top=0">
                    <input type="number" x-model.number="item.data.top" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                    <input type="range" x-model.number="item.data.top" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                  </div>
                  <div class="xslider">
                    <label>Bottom</label>
                    <input type="reset" x-on:click="item.data.bottom=0">
                    <input type="number" x-model.number="item.data.bottom" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                    <input type="range" x-model.number="item.data.bottom" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                  </div>
                  <div class="xslider">
                    <label>Right</label>
                    <input type="reset" x-on:click="item.data.right=0">
                    <input type="number" x-model.number="item.data.right" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                    <input type="range" x-model.number="item.data.right" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                  </div>
                  <div class="xslider">
                    <label>Left</label>
                    <input type="reset" x-on:click="item.data.left=0">
                    <input type="number" x-model.number="item.data.left" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                    <input type="range" x-model.number="item.data.left" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                  </div>
                </div>
              </template>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>

  <!--script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script-->

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.127/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.127/examples/jsm/"
      }
    }
  </script>

  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="dependencies/binparser.js"></script>

  <script type="module" src="camera.js"></script>
  <script src="main.js"></script>

  <!--script type="module" src="parser.js"></script-->
</body>