<head>
    <title>Hello ThreeJS</title>
    <style>
        html, body {
            margin: 0;
            height: 100%;
        }
        #camera {
            width: 100%;
            height: 100%;
        }
        #setting {
            width: 100%;
            height: 100%;
        }
        .PixelSettingsItem {
            margin: 4px;
            background-color:lightgreen;
            padding: 5px;
        }
        .debug {
            background-color:lightcoral;
        }
        #winEditorGrid {
            display: grid;
            width: 100%;
            height: 100%;

            grid-template-columns: auto 256px 50%;
            grid-template-rows: 256px auto;
        }
        #winGlobal {
            grid-column-start: 1;
            grid-column-end: 1;
            grid-row-start: 1;
            grid-row-end: 1;
        }
        #winFaceSelect {
            grid-column-start: 2;
            grid-column-end: 3;
            grid-row-start: 1;
            grid-row-end: 2;
        }
        #winFaceSettings {
            grid-column-start: 3;
            grid-column-end: 4;
            grid-row-start: 1;
            grid-row-end: 3;
        }
        #winCamera {
            grid-column-start: 1;
            grid-column-end: 3;
            grid-row-start: 2;
            grid-row-end: 3;
        }

    </style>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <div x-data='{
        CONST:{
            transformations:{
                displacement: "displacement",
                uv_offset: "uv_offset",
                uv_crop: "uv_crop",
                post_flags: "post_flags",
                pre_flags: "pre_flags",
            },

            asym_directions:{
                top: "Top",
                bottom: "Botton",
                right: "Right",
                left: "Left",
            },

            asym_modes:{
                normal: "Normal",
                specialA: "SpecialA",
                specialB: "SpecialB",
                specialC: "SpecialC",
            },

            displacement_slider_max:63,
            displacement_slider_min:-63,
            uv_offset_slider_max:63,
            uv_offset_slider_min:0,
            uv_crop_slider_max:63,
            uv_crop_slider_min:0,

            default_transform:{
                displacement: {offset:0, asym_offset:0, asym_direction:"Top", asym_mode:"Normal", snap:false},
                uv_offset: {x_min:8, x_max:8, y_min:16, y_max:16},
                uv_crop: {top:0, bottom:0, left:0, right:0},
                post_flags: {clip_top:true, clip_bottom:true, clip_right:false, clip_left:false},
                pre_flags: {},
            },
        }
    }'>
        <div id="winEditorGrid">
            <div id="winGlobal"></div>
            <div id="winCamera">
                <canvas id="camera"></canvas>
            </div>
            <div id="winFaceSelect">
                <div id=>

                </div>
            </div>
            <div id="winFaceSettings">
                <div id="setting" class="PixelSettings" x-data='{content:[]}'>
                    <template x-for="(item, index) in content" :key="item.id">
                        <div class="PixelSettingsItem">
                            <!--Transform Type / Delete DOM-->
                            <div>
                                <select x-model="item.type" x-on:change='
                                    item.data = JSON.parse(JSON.stringify(CONST.default_transform[item.type]));
                                '>
                                    <template x-for="transformation in CONST.transformations">
                                        <option x-html="transformation"></option>
                                    </template>
                                </select>
                                <button type="button" x-on:click='content.splice(index, 1)'>Delete Transform</button>
                            </div>

                            <br><div class="debug" x-html='JSON.stringify(item)'></div><br>

                            <!--Displacement DOM-->
                            <template x-if='item.type == CONST.transformations.displacement'>
                                <div>
                                    <label>Snap to opposing layer</label>
                                    <input type="checkbox" x-model="item.data.snap"><br><br>

                                    <label>Displacement in quarter pixels (between -63 and 63):</label>
                                    <div class="xslider">
                                        <input type="reset" x-on:click="item.data.offset=0">
                                        <input type="number" x-model.number="item.data.offset" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                                        <input type="range" x-model.number="item.data.offset" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                                    </div><br>

                                    <label>Assymetric Direction:</label>
                                    <select x-model="item.data.asym_direction">
                                        <template x-for="asym_dir in CONST.asym_directions">
                                            <option x-html="asym_dir"></option>
                                        </template>
                                    </select><br><br>

                                    <label>Assymetric Mode:</label>
                                    <select x-model="item.data.asym_mode">
                                        <template x-for="asym_mode in CONST.asym_modes">
                                            <option x-html="asym_mode"></option>
                                        </template>
                                    </select><br><br>

                                    <div x-show='item.data.asym_mode==CONST.asym_modes.normal'>
                                        <label>Assymetric Displacement in quarter pixels (between -63 and 63):</label>
                                        <div class="xslider">
                                            <input type="reset" x-on:click="item.data.asym_offset=0">
                                            <input type="number" x-model.number="item.data.asym_offset" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                                            <input type="range" x-model.number="item.data.asym_offset" x-bind:min="CONST.displacement_slider_min" x-bind:max="CONST.displacement_slider_max">
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!--PostFlags DOM-->
                            <template x-if='item.type == CONST.transformations.post_flags'>
                                <div>
                                    <label>UV Scale Fix</label><br>
                                    <label>Top</label>
                                    <input type="checkbox" x-model="item.data.clip_top"><br>
                                    <label>Bottom</label>
                                    <input type="checkbox" x-model="item.data.clip_bottom"><br>
                                    <label>Left</label>
                                    <input type="checkbox" x-model="item.data.clip_left"><br>
                                    <label>Right</label>
                                    <input type="checkbox" x-model="item.data.clip_right"><br>
                                </div>
                            </template>

                            <!--UV Offset DOM-->
                            <template x-if='item.type == CONST.transformations.uv_offset'>
                                <div>
                                    <label>UV Crop</label><br>
                                    <div class="xslider">
                                        <label>X min</label>
                                        <input type="reset" x-on:click="item.data.x_min=0">
                                        <input type="number" x-model.number="item.data.x_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                        <input type="range" x-model.number="item.data.x_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                    </div>
                                    <div class="xslider">
                                        <label>X max</label>
                                        <input type="reset" x-on:click="item.data.x_max=0">
                                        <input type="number" x-model.number="item.data.x_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                        <input type="range" x-model.number="item.data.x_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                    </div>
                                    <div class="xslider">
                                        <label>Y min</label>
                                        <input type="reset" x-on:click="item.data.y_min=0">
                                        <input type="number" x-model.number="item.data.y_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                        <input type="range" x-model.number="item.data.y_min" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                    </div>
                                    <div class="xslider">
                                        <label>Y max</label>
                                        <input type="reset" x-on:click="item.data.y_max=0">
                                        <input type="number" x-model.number="item.data.y_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                        <input type="range" x-model.number="item.data.y_max" x-bind:min="CONST.uv_offset_slider_min" x-bind:max="CONST.uv_offset_slider_max">
                                    </div>
                                </div>
                            </template>

                            <!--UV Crop DOM-->
                            <template x-if='item.type == CONST.transformations.uv_crop'>
                                <div>
                                    <label>UV Offset</label><br>
                                    <div class="xslider">
                                        <label>Top</label>
                                        <input type="reset" x-on:click="item.data.top=0">
                                        <input type="number" x-model.number="item.data.top" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                        <input type="range" x-model.number="item.data.top" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                    </div>
                                    <div class="xslider">
                                        <label>Bottom</label>
                                        <input type="reset" x-on:click="item.data.bottom=0">
                                        <input type="number" x-model.number="item.data.bottom" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                        <input type="range" x-model.number="item.data.bottom" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                    </div>
                                    <div class="xslider">
                                        <label>Right</label>
                                        <input type="reset" x-on:click="item.data.right=0">
                                        <input type="number" x-model.number="item.data.right" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                        <input type="range" x-model.number="item.data.right" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                    </div>
                                    <div class="xslider">
                                        <label>Left</label>
                                        <input type="reset" x-on:click="item.data.left=0">
                                        <input type="number" x-model.number="item.data.left" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                        <input type="range" x-model.number="item.data.left" x-bind:min="CONST.uv_crop_slider_min" x-bind:max="CONST.uv_crop_slider_max">
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!--Add New Transform DOM-->
                    <div class="PixelSettingsItem">
                        <button type="button" x-on:click='
                            ids = content.map((x) => x.id);
                            max = Math.max(0, ...ids);
                            content.push({
                                id:(max+1),
                                type:CONST.transformations.displacement,
                                data:JSON.parse(JSON.stringify(CONST.default_transform.displacement))
                            })
                        '>Add New Transform</button>
                        <button type="button" x-on:click="alert(JSON.stringify(content))">Debug Transform List</button>
                        <button type="button" x-on:click="content=[]">Delete All Transforms</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r127/three.min.js"></script>
    <script src="https://r105.threejsfundamentals.org/threejs/resources/threejs/r105/js/controls/OrbitControls.js"></script>
    <script src="https://r105.threejsfundamentals.org/threejs/resources/threejs/r105/js/loaders/LoaderSupport.js"></script>
    <script src="https://r105.threejsfundamentals.org/threejs/resources/threejs/r105/js/loaders/OBJLoader2.js"></script>
    <script src="https://r105.threejsfundamentals.org/threejs/resources/threejs/r105/js/loaders/MTLLoader.js"></script>
    <script src="threejs.js"></script>
    -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.127/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.127/examples/jsm/"
          }
        }
    </script>

    <script type="text/javascript" src="dependencies/binparser.js"></script>
    <script type="module" src="camera.js"></script>
</body>